#!/usr/bin/env sh
# Get the actual script location (handles symlinks)
if [ -L "$0" ]; then
  # If it's a symlink, resolve it
  SCRIPT_DIR="$(dirname "$(readlink -f "$0")")"
else
  SCRIPT_DIR="$(dirname "$0")"
fi

# Try to find husky.sh relative to the script
if [ -f "$SCRIPT_DIR/_/husky.sh" ]; then
  . "$SCRIPT_DIR/_/husky.sh"
else
  echo "husky: cannot find husky.sh at $SCRIPT_DIR/_/husky.sh"
  exit 1
fi

# Source Node.js environment if available
if [ -f "$HOME/.nvm/nvm.sh" ]; then
  . "$HOME/.nvm/nvm.sh"
elif [ -f "/usr/local/opt/nvm/nvm.sh" ]; then
  . "/usr/local/opt/nvm/nvm.sh"
fi

# Run lint-staged to format, type-check, and test staged files
npx lint-staged

# Run full type check (to catch any type errors in the entire codebase)
echo "Running full type check..."
npm run type-check

# Run all tests (to ensure nothing is broken)
echo "Running all tests..."
npm test -- --passWithNoTests

